I"Š-<h2 id="1-ê°œìš”">1. ê°œìš”</h2>

<p><a href="How-To-Thread-Tuning-Coherence-Web-3">How-To-Thread-Tuning-Coherence-Web-3</a> ì—ì„œ ëª‡ê°€ì§€ ê°„ë‹¨í•œ ë¶€í•˜í…ŒìŠ¤íŠ¸ì™€ í•¨ê»˜, íŠœë‹ì— íš¨ê³¼ê°€ ìˆëŠ”ì§€ ì‚´í´ë³´ì•˜ëŠ”ë°, í…ŒìŠ¤íŠ¸ ë°©ì‹ì´ ì¡°ì¡í•˜ì—¬ ì´ë²ˆì— ì¢€ ë” ì •ê·œí™” ê³¼ì •ìœ¼ë¡œ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‚¬ìš©í•´ë³¸ë‹¤.</p>

<p><br /></p>
<h2 id="2-ì„¤ëª…">2. ì„¤ëª…</h2>

<p>ì£¼ê¸°ì  Sessionì„ Scaní•˜ì—¬ Timeout ëœ ê°ì²´ëŠ” invalidate í•˜ì—¬ IsValid=Falseë¡œ ë³€ê²½í•˜ëŠ” Reaper Threadì— ëŒ€í•´ì„œ, ì˜¤ëœì‹œê°„ ë¶€í•˜ í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•˜ì—¬ ì„±ëŠ¥ ê°œì„ ì´ ì´ë¤„ì§€ëŠ”ì§€ ì‚´í´ë³¸ë‹¤.</p>

<p><br /></p>
<h2 id="3-í…ŒìŠ¤íŠ¸-í™˜ê²½">3. í…ŒìŠ¤íŠ¸ í™˜ê²½</h2>

<ul>
  <li>OS : Oracle Linux Server release 8.7</li>
  <li>JDK : 1.7.0_80</li>
  <li>WebLogic 11g</li>
  <li>Coherence 3.7.1.22 * WEB SPI</li>
</ul>

<p><br /></p>
<ul>
  <li>JMeter
    <ul>
      <li>ì§€ì†ì ìœ¼ë¡œ 20 Users ë¶€í•˜ë¥¼ ì£¼ë©°, ë¹ ë¥´ê²Œ New Sessoin ìƒì„±</li>
    </ul>
  </li>
</ul>

<p><br /></p>
<ul>
  <li>
    <p>Monitoring Script</p>

    <ul>
      <li>
        <p>ë‹¤ìŒì˜ Scriptë¡œ ë°ì´í„°ë¥¼ ì¶”ì¶œí•˜ì—¬ í†µê³„ë¥¼ ë‚´ë³¸ë‹¤.</p>
      </li>
      <li>
        <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
</pre></td><td class="rouge-code"><pre><span class="c1"># import
</span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>
    
<span class="c1"># log file
</span><span class="n">fo</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">"/tmp/coh.log"</span><span class="p">,</span> <span class="s">"wb+"</span><span class="p">)</span>
    
<span class="c1"># connection information
</span><span class="n">username</span> <span class="o">=</span> <span class="s">'weblogic'</span>
<span class="n">password</span> <span class="o">=</span> <span class="s">'weblogic1'</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">'wls.local:8002'</span>
    
<span class="c1"># connect to server
</span><span class="n">connect</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
    
<span class="c1"># get LocalMemberId
</span><span class="n">cd</span><span class="p">(</span><span class="s">'custom:/Coherence/Coherence:type=Cluster'</span><span class="p">)</span>
<span class="n">localMemberId</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="s">'LocalMemberId'</span><span class="p">))</span>
    
<span class="c1"># change dir to cohSessionApp
</span><span class="n">cd</span><span class="p">(</span><span class="s">'custom:/Coherence/Coherence:type=WebLogicHttpSessionManager,nodeId='</span> <span class="o">+</span> <span class="n">localMemberId</span> <span class="o">+</span> <span class="s">',appId=cohSessionAppcohSessionApp'</span><span class="p">)</span>
    
    
<span class="n">gap</span> <span class="o">=</span> <span class="mi">5000</span>
<span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">):</span>
        <span class="c1">###### print MBeans ######
</span>        <span class="c1">### Attr to Var ###
</span>        <span class="c1"># Reaper Cycle
</span>        <span class="n">NextReapCycle</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="s">'NextReapCycle'</span><span class="p">))</span>
        <span class="n">LastReapCycle</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="s">'LastReapCycle'</span><span class="p">))</span>
    
        <span class="c1"># Reap Duration
</span>        <span class="n">AverageReapDuration</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="s">'AverageReapDuration'</span><span class="p">))</span>
        <span class="n">LastReapDuration</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="s">'LastReapDuration'</span><span class="p">))</span>
        <span class="n">MaxReapDuration</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="s">'MaxReapDuration'</span><span class="p">))</span>
    
        <span class="c1"># Reaped Sessions
</span>        <span class="n">AverageReapedSessions</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="s">'AverageReapedSessions'</span><span class="p">))</span>
        <span class="n">MaxReapedSessions</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="s">'MaxReapedSessions'</span><span class="p">))</span>
        <span class="n">ReapedSessions</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="s">'ReapedSessions'</span><span class="p">))</span>
        <span class="n">ReapedSessionsTotal</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="s">'ReapedSessionsTotal'</span><span class="p">))</span>
    
        <span class="c1"># Sessions
</span>        <span class="n">SessionUpdates</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="s">'SessionUpdates'</span><span class="p">))</span>
    
    
        <span class="c1">### Var to Log ###
</span>        <span class="n">dm</span> <span class="o">=</span> <span class="s">" | "</span>
        <span class="n">writeLogData</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="o">+</span> <span class="n">dm</span>
        <span class="n">writeLogData</span> <span class="o">+=</span> <span class="n">NextReapCycle</span> <span class="o">+</span> <span class="n">dm</span>
        <span class="n">writeLogData</span> <span class="o">+=</span> <span class="n">LastReapCycle</span> <span class="o">+</span> <span class="n">dm</span>
    
        <span class="n">writeLogData</span> <span class="o">+=</span> <span class="n">AverageReapDuration</span> <span class="o">+</span> <span class="n">dm</span>
        <span class="n">writeLogData</span> <span class="o">+=</span> <span class="n">LastReapDuration</span> <span class="o">+</span> <span class="n">dm</span>
        <span class="n">writeLogData</span> <span class="o">+=</span> <span class="n">MaxReapDuration</span> <span class="o">+</span> <span class="n">dm</span>
    
        <span class="n">writeLogData</span> <span class="o">+=</span> <span class="n">AverageReapedSessions</span> <span class="o">+</span> <span class="n">dm</span>
        <span class="n">writeLogData</span> <span class="o">+=</span> <span class="n">MaxReapedSessions</span> <span class="o">+</span> <span class="n">dm</span>
        <span class="n">writeLogData</span> <span class="o">+=</span> <span class="n">ReapedSessions</span> <span class="o">+</span> <span class="n">dm</span>
        <span class="n">writeLogData</span> <span class="o">+=</span> <span class="n">ReapedSessionsTotal</span> <span class="o">+</span> <span class="n">dm</span>
    
        <span class="n">writeLogData</span> <span class="o">+=</span> <span class="n">SessionUpdates</span>
    
        <span class="n">fo</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">writeLogData</span><span class="o">+</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>
        <span class="n">fo</span><span class="p">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="n">writeLogData</span><span class="p">)</span>
        <span class="n">Thread</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">gap</span><span class="p">)</span>
    
<span class="n">fo</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
<span class="nb">exit</span><span class="p">()</span>
    
</pre></td></tr></tbody></table></code></pre></div>        </div>
      </li>
    </ul>
  </li>
</ul>

<p><br /></p>
<h2 id="4-performance-test">4. Performance Test</h2>

<p>Jmeter 20 Users ê°€ ì§€ì†ì ìœ¼ë¡œ ì„¸ì…˜ì„ ìƒì„±í•˜ëŠ” ê³¼ì •ì—ì„œ, ìœ„ ìŠ¤í¬ë¦½íŠ¸ë¡œ ìë£Œë¥¼ ëª¨ì•„ ì—‘ì…€ë¡œ í‰ê· ì„ ë½‘ì•„ ë³´ì•˜ë‹¤.</p>

<p><br />
<img src="/../assets/posts/images/20-Coherence/Performance-Test-In-Coherence-Web-3/Performance-Test-In-Coherence-Web-3_1.png" alt="Performance-Test-In-Coherence-Web-3_1" /></p>

<p><br />
Row ìˆœì„œëŒ€ë¡œ, <code class="language-plaintext highlighter-rouge">wm/CoherenceWorkManager</code> ì˜ Min/MaxThreadsë¥¼ 4, 8, 16 ìˆœìœ¼ë¡œ ìœ ì‚¬í•˜ê²Œ í…ŒìŠ¤íŠ¸í•œ ê²°ê³¼ì˜ í‰ê· ì¹˜ì´ë‹¤.</p>

<p><br />
AverageReapDuraton, Threadsê°€ ì¦ê°€í•  ìˆ˜ë¡ ì „ì²´ì ìœ¼ë¡œ Reap Durationì´ ê°ì†Œë˜ì—ˆë‹¤.</p>

<p>LastReapDuration, ê°€ì¥ ìµœê·¼ì˜ Reap Duration</p>

<p>MaxReapDuration, ê°€ì¥ ë†’ì€ Reap Duration</p>

<p>AverageReapedSessions, í‰ê·  Reaped ë˜ëŠ” Session ìˆ˜, Threadsê°€ ëŠ˜ì—ˆìŒì—ë„ ë³€í™”ê°€ ì—†ë‹¤.</p>

<p>MaxReapedSessions, ê°€ì¥ ë†’ì€ Reaped ëœ Session ìˆ˜, Threadsê°€ ëŠ˜ì—ˆìŒì—ë„ ë³€í™”ê°€ ì—†ë‹¤.</p>

<p>ReapedSessions, ê°€ì¥ ìµœê·¼ì— Reaped ëœ Session ìˆ˜, Threadsê°€ ëŠ˜ì—ˆìŒì—ë„ ë³€í™”ê°€ ì—†ë‹¤.</p>

<p>ReapedSessionsTotal, ì§€ê¸ˆê¹Œì§€ ì´ Reaped ëœ Session ìˆ˜, Threadsê°€ ëŠ˜ì—ˆìŒì—ë„ ë³€í™”ê°€ ì—†ë‹¤.</p>

<p>SessionUpdates, Jmeterë¡œ ì´ ë°€ì–´ë„£ì€ Session ìˆ˜</p>

<p><br /></p>
<h2 id="5-outcome">5. Outcome</h2>

<p>ìœ„ ìŠ¤í¬ë¦½íŠ¸ëŠ” 5secë§ˆë‹¤ ìˆ˜ì§‘í•˜ê³ , Reaper Threadì˜ ì£¼ê¸°(cycle)ì€ 40ì´ˆë¡œ, ì•½ê°„ Missmatch ë¡œ ë³´ì—¬ì§€ëŠ” í…ŒìŠ¤íŠ¸ê¸´ í•˜ì§€ë§Œ, Threadê°€ ëŠ˜ì–´ë‚¨ì— ë”°ë¼ Reap Durationì´ ìƒë‹¹íˆ ê°œì„ ë˜ëŠ” ê²ƒì´ í™•ì¸ëœë‹¤.</p>

<p>ë‹¤ë§Œ, ì´ ë‹¹ì‹œì— CPU,MEM ì‚¬ìš©ë¥ ì„ ì²´í¬ë¥¼ ì•ˆí•œ ê²ƒì´ ì‹ ê²½ì€ ì“°ì¸ë‹¤.</p>

<p>ë˜í•œ, ë§¤ í…ŒìŠ¤íŠ¸ ì‹œë§ˆë‹¤ ê±°ì˜ ë™ì¼í•œ Jmeterì˜ ë¶€í•˜ëŸ‰ì´ ë“¤ì–´ê°€ë¯€ë¡œ, <code class="language-plaintext highlighter-rouge">Threadsê°€ ëŠ˜ì—ˆìŒì—ë„ ë³€í™”ê°€ ì—†ë‹¤.</code> ë¼ëŠ” ë©”ì‹œì§€ëŠ” ì •ë‹¹ì„±ì´ ë¶€ì—¬ë  ìˆ˜ ìˆì„ ê²ƒ ê°™ë‹¤.</p>

<p><br /></p>
<h2 id="6-references">6. References</h2>

<ul>
  <li><strong>Coherence Web Cache Montoring (Doc ID 2547017.1)</strong></li>
  <li><strong>How to Setup â€œLoopâ€ and â€œSleepâ€ Wait in WLST Script (Doc ID 2860336.1)</strong></li>
</ul>
:ET