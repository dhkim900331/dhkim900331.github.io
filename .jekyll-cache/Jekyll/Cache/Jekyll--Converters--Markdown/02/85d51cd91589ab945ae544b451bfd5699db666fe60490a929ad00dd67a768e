I"ù<h2 id="1-ê°œìš”">1. ê°œìš”</h2>

<p><a href="How-to-install-Coherence-Web-14c">How-to-install-Coherence-Web-14c</a> ì—ì„œ ì„¤ì¹˜ë¥¼ ì™„ë£Œ í–ˆë‹¤.</p>

<p>ì—¬ê¸°ì„œëŠ” ì‹¤ì œ í™˜ê²½ì—ì„œ ì“°ì¼ ìˆ˜ ìˆê²Œ ë‹¤ìŒì˜ í•­ëª©ë“¤ì„ í™•ì¸í•œë‹¤.</p>

<ul>
  <li>Death Detection</li>
  <li>F/W</li>
  <li>Session Reaper Thread Tuning</li>
</ul>

<h2 id="2-death-detection">2. Death Detection</h2>

<p><a href="https://docs.oracle.com/en/middleware/standalone/coherence/14.1.1.0/develop-applications/setting-cluster.html#GUID-FE185358-AE38-4436-9179-73E0D4CAAD13">Configuring Death Detection</a> ì„ í•˜ì—¬, ClusterMember ì´íƒˆ ì—¬ë¶€ë¥¼ í™•ì¸í•œë‹¤.</p>

<h3 id="21-tcp-ring">2.1 TCP-RING</h3>

<p>Memberë“¤ì€ í•˜ë‚˜ì˜ Ringìœ¼ë¡œ ì—°ê²°ëœë‹¤.</p>

<p>25ì´ˆ ë™ì•ˆ HeartBeat ì‘ë‹µì„ ì£¼ì§€ ì•Šì€ Memberë¥¼ 5íšŒ ì‹¤ì‹œí•˜ì—¬, Memberë¥¼ ì œê±°í•œë‹¤.</p>

<p><code class="language-plaintext highlighter-rouge">java.net.InetAddress.isReachable</code> ë¥¼ ì‹œë„í•˜ë©°, ì´ MethodëŠ” Processê°€ ì•„ë‹ˆë¼ Hostì— Port 7(Echo)ë¥¼ ì „ì†¡í•˜ì—¬ ì‘ë‹µì„ ë°›ìœ¼ë ¤ê³  ì‹œë„í•œë‹¤.</p>

<p>Port 7(Echo) ê°€ ë°©í™”ë²½ì— ì˜ˆì™¸ ì²˜ë¦¬ ë˜ì–´ ìˆì–´ì•¼ í•œë‹¤.</p>

<p>listen-backlogëŠ” ì´ëŸ¬í•œ HeartBeat ê°ì§€ë¥¼ ë°›ì„ ë•Œ, ìµœëŒ€ backlog ë¡œ ë³´ì—¬ì§„ë‹¤.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre>    <span class="nt">&lt;tcp-ring-listener&gt;</span>
      <span class="nt">&lt;enabled&gt;</span>true<span class="nt">&lt;/enabled&gt;</span>
      <span class="nt">&lt;ip-timeout</span> <span class="na">system-property=</span><span class="s">"coherence.ipmonitor.pingtimeout"</span><span class="nt">&gt;</span>25s<span class="nt">&lt;/ip-timeout&gt;</span>
      <span class="nt">&lt;ip-attempts&gt;</span>5<span class="nt">&lt;/ip-attempts&gt;</span>
      <span class="nt">&lt;listen-backlog&gt;</span>10<span class="nt">&lt;/listen-backlog&gt;</span>
    <span class="nt">&lt;/tcp-ring-listener&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>ìµœëŒ€ 2ë¶„ 5ì´ˆ ë™ì•ˆ ì‘ë‹µì„ í•˜ì§€ ì•Šì€ Memberê°€ ë°œê²¬ë˜ë©´ ì•„ë˜ì™€ ê°™ì´ Logging ëœë‹¤.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>tmb://10.65.34.245:9003.34707 initiating connection migration with tmb://10.65.34.245:9001.43859 after 2m5s ack timeout health(read=true, write=false), receiptWait=null: peer=tmb://10.65.34.245:9001.43859
</pre></td></tr></tbody></table></code></pre></div></div>

<p>9003 Port Memberê°€ ì‘ë‹µí•˜ì§€ ì•ŠëŠ”ë‹¤.</p>

<p>tcp-ring-listener ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë©´, ì¸ìŠ¤í„´ìŠ¤ê°€ Shutdown ë  ì‹œì— ë§¤ìš° ëŠ¦ê²Œ ê°ì§€ê°€ ëœë‹¤.</p>

<p>ë°˜ë“œì‹œ ì‚¬ìš©í•œë‹¤.</p>

<blockquote>
  <p>tcp-ring-listener false ì‹œì— Member shutdown ì„ í•˜ë©´ 2ë¶„ 5ì´ˆ ë’¤ì— íŒŒì•…ì´ ëœë‹¤.</p>
</blockquote>

<h3 id="22-heartbeat">2.2 HeartBeat</h3>

<p>Cluster Memberë“¤ ê°„ì—ëŠ” HeartBeatë¥¼ ì£¼ê³  ë°›ëŠ”ë‹¤.</p>

<p>ì´ HeartBeat ê°„ê²©ì€ ê¸°ë³¸ê°’ 1ì´ˆ ì´ë©°, Memberê°€ ë§ì„ ê²½ìš° Trafficì´ ì¦ëŒ€í•  ê²ƒì´ë©°, í‰ì†Œ Network ì‹ ë¢°ì„±ì´ ë†’ì€ ê²½ìš°, ë¶ˆí•„ìš”í•˜ê²Œ ë§ì€ Trafficì„ ìœ ë°œí•˜ì§€ ì•Šë„ë¡ ì„¤ì •ê°’ì„ ë³€ê²½í•˜ëŠ” ê²ƒë„ ê³ ë ¤í•´ë³¼ ë§Œ í•˜ë‹¤.</p>

<p>ë¬¸ì„œ ìƒì—ëŠ”, HeartBeatë¥¼ ë§¤ ê°„ê²©ë§ˆë‹¤ ë³´ë‚´ì§€ ì•Šê³ , ë‚´ë¶€ í‰ê°€ í”„ë¡œì„¸ìŠ¤ì— ë”°ë¼ ê·¸ëŸ¬í•˜ë‹¤ê³  í•˜ëŠ”ë° ì–´ë–¤ í”„ë¡œì„¸ìŠ¤ë¥¼ ê°€ì§€ëŠ”ì§€ëŠ” ë¬¸ì„œìƒì— ë³´ì´ì§€ ì•ŠëŠ”ë‹¤.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>    <span class="nt">&lt;packet-publisher&gt;</span>
      <span class="nt">&lt;packet-delivery&gt;</span>
        <span class="nt">&lt;heartbeat-milliseconds&gt;</span>5000<span class="nt">&lt;/heartbeat-milliseconds&gt;</span>
      <span class="nt">&lt;/packet-delivery&gt;</span>
    <span class="nt">&lt;/packet-publisher&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="3-firewall">3. Firewall</h2>

<ul>
  <li>Cluster Port (Default 7574) ëŠ” Multicast/Unicast ì—ì„œ ëª¨ë‘ ì‚¬ìš©ë˜ê³ , UDP/TCP ë¡œ ì“°ì¸ë‹¤. Coherenceì— Proxyë¥¼ êµ¬ì„±í•˜ê³ , Clientì—ì„œ Naming Serviceë¡œ Proxyë¥¼ ì´ìš©í•  ë•Œ Nameì„ ê²€ìƒ‰í•˜ëŠ” Port.
    <ul>
      <li>Cluster Portê°€ Unicast ì—ì„œ ì‚¬ìš©ë˜ëŠ” ì‹œê¸°ëŠ”, WKA(Well-Known-Addresses) ë¥¼ ì‚¬ìš©í•  ë•Œë‹¤. WKA ë©¤ë²„ë¥¼ ì°¾ì„ ë•Œ, Cluster Portë¥¼ ì‚¬ìš©í•œë‹¤.</li>
    </ul>
  </li>
  <li>Death Detection ì„ ìœ„í•´ TCP 7 (Echo port)ë¥¼ ì‚¬ìš©í•œë‹¤.</li>
  <li>ìœ„ ì™¸ì— ë©”ë‰´ì–¼ìƒ í•„ìš”í•œ PortëŠ” ì—†ê³ , Memberê°„ì˜ í†µì‹  ë°©ì‹ì— ì‚¬ìš©í•˜ëŠ” Portë¥¼ ì—´ì–´ì£¼ë©´ ëœë‹¤.</li>
</ul>

<h2 id="4-mbean-monitoring">4. MBean Monitoring</h2>

<p>ë‹¤ìŒ ì˜µì…˜ì„ ì¶”ê°€í•˜ì—¬, WLST MBean ì„ Monitoring í•  ìˆ˜ ìˆë‹¤.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nt">-Djavax</span>.management.builder.initial<span class="o">=</span>weblogic.management.jmx.mbeanserver.WLSMBeanServerBuilder
</pre></td></tr></tbody></table></code></pre></div></div>

<p>MBean Coherence Treeë¥¼ ì°¾ì•„ê°€ë ¤ë©´, ì•„ë˜ì™€ ê°™ì€ í•µì‹¬ì½”ë“œê°€ í•„ìš”í•˜ë‹¤.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="c"># connect to server</span>
connect<span class="o">(</span>username, password, url<span class="o">)</span>
    
<span class="c"># get LocalMemberId</span>
<span class="nb">cd</span><span class="o">(</span><span class="s1">'custom:/Coherence/Coherence:type=Cluster'</span><span class="o">)</span>
localMemberId <span class="o">=</span> str<span class="o">(</span>get<span class="o">(</span><span class="s1">'LocalMemberId'</span><span class="o">))</span>
    
<span class="c"># change dir to cohSessionApp</span>
<span class="nb">cd</span><span class="o">(</span><span class="s1">'custom:/Coherence/Coherence:type=WebLogicHttpSessionManager,nodeId='</span> + localMemberId + <span class="s1">',appId=&lt;app-name&gt;'</span><span class="o">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="5-jmx-monitoring">5. JMX Monitoring</h2>

<p><a href="https://docs.oracle.com/en/middleware/standalone/coherence/14.1.1.0/manage/using-jmx-manage-oracle-coherence.html#GUID-844DAAE6-6F00-4B15-AA44-47C3F595A6C5">Allowing Remote Access to Oracle Coherence MBeans</a></p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="nt">-Dcoherence</span>.management<span class="o">=</span>all
<span class="nt">-Dcoherence</span>.management.remote<span class="o">=</span><span class="nb">true</span>
<span class="nt">-Dcom</span>.sun.management.jmxremote.port<span class="o">=</span>&lt;JMX port&gt;
<span class="nt">-Dcom</span>.sun.management.jmxremote.authenticate<span class="o">=</span><span class="nb">false</span>
<span class="nt">-Dcom</span>.sun.management.jmxremote.ssl<span class="o">=</span><span class="nb">false</span>
<span class="nt">-Djava</span>.rmi.server.hostname<span class="o">=</span>wls.local
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Coherence Clusterë¥¼ ì‚¬ìš©í•˜ëŠ” WebApp ì´ ë°°í¬ëœ Managed Coherence Serverì— ì„¤ì • í›„ JConsoleì„ í†µí•´ MBean ì„ ì½ì„ ìˆ˜ ìˆë‹¤.</p>

<p><img src="/../assets/posts/images/How-to-use-Coherence-Web-14c/image-20230424145943477.png" alt="image-20230424145943477" style="zoom: 33%;" /></p>

<p>Coherence - WebLogicHttpSessionManager - &lt;Member ID&gt; - &lt;Web App&gt; - Attributes ì—ì„œ ì²˜ë¦¬ë˜ëŠ” Session í†µê³„ë¥¼ ì•Œ ìˆ˜ ìˆë‹¤.</p>

<p>Member IDëŠ” Nodeì˜ ê° Attributes ì—ì„œ MemberNameì´ë‚˜ ProcessName ìœ¼ë¡œ íšë“í•˜ë©´ ìˆ˜ì›”í•˜ê² ë‹¤.</p>

<p><img src="/../assets/posts/images/How-to-use-Coherence-Web-14c/image-20230424151956264.png" alt="image-20230424151956264" /></p>

<p>ì˜ˆì‹œ í™”ë©´ì—ì„œëŠ” Unique í•˜ê²Œ ë˜ì–´ ìˆì§€ ì•Šì€ë°, Operational Override Fileì—ì„œ ì§€ì •í•˜ë©´ ëœë‹¤.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>      <span class="nt">&lt;process-name</span> <span class="na">system-property=</span><span class="s">"coherence.process"</span><span class="nt">&gt;</span>process_base_domain<span class="nt">&lt;/process-name&gt;</span>
      <span class="nt">&lt;member-name</span>  <span class="na">system-property=</span><span class="s">"coherence.member"</span><span class="nt">&gt;</span>member_base_domain<span class="nt">&lt;/member-name&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="6-session-reaper-thread">6. Session Reaper Thread</h2>

<p>App ì—ì„œ ìƒì„±ëœ HTTP Sessionì€ timeout-secs ë§Œí¼ ìœ íš¨í•˜ë‹¤.</p>

<p>invalidation-internal-secs ë§ˆë‹¤ All HTTP Sessionì„ Scaní•˜ì—¬ invalid í•œ sessionì„ ì‚­ì œí•˜ì—¬ Memoryë¥¼ í™•ë³´í•œë‹¤.</p>

<h3 id="61-ready-for-test">6.1 Ready For Test</h3>

<h4 id="1-wlst">(1) WLST</h4>

<p><a href="#h-4-mbean-monitoring">4. MBean Monitoring</a> ì„ ì´ìš©í•˜ì—¬ ì•„ë˜ì˜ Codeë¥¼ ì‘ì„±í•˜ê³ ,</p>

<p>Session ë¶€í•˜ë¥¼ ë°œìƒ ì‹œí‚¬ ë•Œ, Reaper Threadê°€ ì–´ë–»ê²Œ ë™ì‘í•˜ëŠ”ì§€ ì•Œì•„ë³¸ë‹¤.</p>

<p>WLST MBean code</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
</pre></td><td class="rouge-code"><pre><span class="n">java</span> <span class="o">-</span><span class="n">Djava</span><span class="p">.</span><span class="n">security</span><span class="p">.</span><span class="n">egd</span><span class="o">=</span><span class="nb">file</span><span class="p">:</span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">urandom</span> <span class="n">weblogic</span><span class="p">.</span><span class="n">WLST</span> <span class="o">&lt;&lt;</span> <span class="n">EOF</span>
<span class="c1"># import
</span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="c1"># log file
</span><span class="n">fo</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">"/tmp/coh.log"</span><span class="p">,</span> <span class="s">"wb+"</span><span class="p">)</span>

<span class="c1"># connection information
</span><span class="n">username</span> <span class="o">=</span> <span class="s">'weblogic'</span>
<span class="n">password</span> <span class="o">=</span> <span class="s">'weblogic1'</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">'wls.local:8002'</span>

<span class="c1"># connect to server
</span><span class="n">connect</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>

<span class="c1"># get LocalMemberId
</span><span class="n">cd</span><span class="p">(</span><span class="s">'custom:/Coherence/Coherence:type=Cluster'</span><span class="p">)</span>
<span class="n">localMemberId</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="s">'LocalMemberId'</span><span class="p">))</span>

<span class="c1"># change dir to cohSessionApp
</span><span class="n">cd</span><span class="p">(</span><span class="s">'custom:/Coherence/Coherence:type=WebLogicHttpSessionManager,nodeId='</span> <span class="o">+</span> <span class="n">localMemberId</span> <span class="o">+</span> <span class="s">',appId=cohSessionAppcohSessionApp'</span><span class="p">)</span>

<span class="n">sleep_in_ms</span> <span class="o">=</span> <span class="mi">5000</span>
<span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">):</span>
  <span class="c1">###### print MBeans ######
</span>  <span class="c1">### Attr to Var ###
</span>  <span class="c1"># Reaper Cycle
</span>  <span class="n">LastReapCycle</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="s">'LastReapCycle'</span><span class="p">))</span>
  <span class="n">NextReapCycle</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="s">'NextReapCycle'</span><span class="p">))</span>
  
  <span class="c1"># Reap Duration
</span>  <span class="n">AverageReapDuration</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="s">'AverageReapDuration'</span><span class="p">))</span>
  <span class="n">LastReapDuration</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="s">'LastReapDuration'</span><span class="p">))</span>
  <span class="n">MaxReapDuration</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="s">'MaxReapDuration'</span><span class="p">))</span>
  
  <span class="c1"># Reaped Sessions
</span>  <span class="n">AverageReapedSessions</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="s">'AverageReapedSessions'</span><span class="p">))</span>
  <span class="n">MaxReapedSessions</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="s">'MaxReapedSessions'</span><span class="p">))</span>
  <span class="n">ReapedSessions</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="s">'ReapedSessions'</span><span class="p">))</span>
  <span class="n">ReapedSessionsTotal</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="s">'ReapedSessionsTotal'</span><span class="p">))</span>
  
  <span class="c1"># Sessions
</span>  <span class="n">SessionUpdates</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="s">'SessionUpdates'</span><span class="p">))</span>
  <span class="n">OverflowUpdates</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="s">'OverflowUpdates'</span><span class="p">))</span>
  
  <span class="c1">### Var to Log ###
</span>  <span class="n">dm</span> <span class="o">=</span> <span class="s">" | "</span>
  <span class="n">writeLogData</span> <span class="o">=</span> <span class="s">""</span>
  
  <span class="c1"># Print Init Header
</span>  <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">writeLogData</span> <span class="o">+=</span> <span class="s">"LastReapCycle"</span> <span class="o">+</span> <span class="n">dm</span>
    <span class="n">writeLogData</span> <span class="o">+=</span> <span class="s">"NextReapCycle"</span> <span class="o">+</span> <span class="n">dm</span>
    
    <span class="n">writeLogData</span> <span class="o">+=</span> <span class="s">"AverageReapDuration"</span> <span class="o">+</span> <span class="n">dm</span>
    <span class="n">writeLogData</span> <span class="o">+=</span> <span class="s">"LastReapDuration"</span> <span class="o">+</span> <span class="n">dm</span>
    <span class="n">writeLogData</span> <span class="o">+=</span> <span class="s">"MaxReapDuration"</span> <span class="o">+</span> <span class="n">dm</span>
    
    <span class="n">writeLogData</span> <span class="o">+=</span> <span class="s">"AverageReapedSessions"</span> <span class="o">+</span> <span class="n">dm</span>
    <span class="n">writeLogData</span> <span class="o">+=</span> <span class="s">"MaxReapedSessions"</span> <span class="o">+</span> <span class="n">dm</span>
    <span class="n">writeLogData</span> <span class="o">+=</span> <span class="s">"ReapedSessions"</span> <span class="o">+</span> <span class="n">dm</span>
    <span class="n">writeLogData</span> <span class="o">+=</span> <span class="s">"ReapedSessionsTotal"</span> <span class="o">+</span> <span class="n">dm</span>
    
    <span class="n">writeLogData</span> <span class="o">+=</span> <span class="s">"SessionUpdates"</span> <span class="o">+</span> <span class="n">dm</span>
    <span class="n">writeLogData</span> <span class="o">+=</span> <span class="s">"OverflowUpdates"</span> <span class="o">+</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span>
  
  <span class="n">writeLogData</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="o">+</span> <span class="n">dm</span>
  <span class="n">writeLogData</span> <span class="o">+=</span> <span class="n">LastReapCycle</span> <span class="o">+</span> <span class="n">dm</span>
  <span class="n">writeLogData</span> <span class="o">+=</span> <span class="n">NextReapCycle</span> <span class="o">+</span> <span class="n">dm</span>
  
  <span class="n">writeLogData</span> <span class="o">+=</span> <span class="n">AverageReapDuration</span> <span class="o">+</span> <span class="n">dm</span>
  <span class="n">writeLogData</span> <span class="o">+=</span> <span class="n">LastReapDuration</span> <span class="o">+</span> <span class="n">dm</span>
  <span class="n">writeLogData</span> <span class="o">+=</span> <span class="n">MaxReapDuration</span> <span class="o">+</span> <span class="n">dm</span>
  
  <span class="n">writeLogData</span> <span class="o">+=</span> <span class="n">AverageReapedSessions</span> <span class="o">+</span> <span class="n">dm</span>
  <span class="n">writeLogData</span> <span class="o">+=</span> <span class="n">MaxReapedSessions</span> <span class="o">+</span> <span class="n">dm</span>
  <span class="n">writeLogData</span> <span class="o">+=</span> <span class="n">ReapedSessions</span> <span class="o">+</span> <span class="n">dm</span>
  <span class="n">writeLogData</span> <span class="o">+=</span> <span class="n">ReapedSessionsTotal</span> <span class="o">+</span> <span class="n">dm</span>
  
  <span class="n">writeLogData</span> <span class="o">+=</span> <span class="n">OverflowUpdates</span> <span class="o">+</span> <span class="n">dm</span>
  <span class="n">writeLogData</span> <span class="o">+=</span> <span class="n">SessionUpdates</span>
  
  <span class="n">fo</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">writeLogData</span><span class="o">+</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>
  <span class="n">fo</span><span class="p">.</span><span class="n">flush</span><span class="p">()</span>
  <span class="k">print</span><span class="p">(</span><span class="n">writeLogData</span><span class="p">)</span>
  <span class="n">Thread</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">sleep_in_ms</span><span class="p">)</span>

<span class="n">fo</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
<span class="nb">exit</span><span class="p">()</span>
<span class="n">EOF</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h4 id="2-test-application">(2) Test Application</h4>

<p>Session ì„ ì›í•˜ëŠ” Sizeë§Œí¼ ìƒì„± ì‹œí‚¤ëŠ” Applicationì€ <a href="http://localhost:4000/coherence/Coherence-Session-Test-Application">Coherence-Session-Test-Application</a> ì„ ì‚¬ìš©í•œë‹¤.</p>

<h4 id="3-apache-jmeter">(3) Apache JMeter</h4>

<p>Apache JMeterëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì„¤ì •í–ˆë‹¤.</p>

<ul>
  <li>Thread Group
    <ul>
      <li>Number of Threads (users): 50</li>
      <li>Ramp-up period (seconds): 1</li>
      <li>Loop Count: Infinite</li>
      <li>Use KeepAlive: X (No)</li>
      <li>Specify Thread lifetime
        <ul>
          <li>Duration(Seconds) : 300</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p>1ì´ˆ ì´ë‚´ì— 50ëª…ì˜ ì‚¬ìš©ìê°€ ì¤€ë¹„ë˜ë©°, ì§€ì†ì ìœ¼ë¡œ ì‹ ê·œ ì‚¬ìš©ìì²˜ëŸ¼ ìœ ì…ëœë‹¤.</p>

<p>ì´ ì‘ì—…ì€ 300 secs ë™ì•ˆ ì§€ì†ëœë‹¤. TPSë¡œ í™˜ì‚°í•  ìˆ˜ ì—†ìœ¼ë‚˜, ì„±ëŠ¥ì´ ì¢‹ì§€ ì•Šì€ Local ì—ì„œ ì‘ì—…í•˜ê¸°ì—ëŠ” ê½¤ í´ ê²ƒì´ë‹¤.</p>

<p>ì„±ëŠ¥ì´ ì¢‹ì§€ ì•Šì€ Local Test System ì—ì„œ ì‘ì—…í•˜ë‹ˆ, ì‚¬ìš©ìë¥¼ ë” í¬ê²Œ ëŠ˜ë¦´ ìˆ˜ ì—†ì—ˆë‹¤.</p>

<p>ëŠ˜ë¦¬ëŠ” ê²½ìš°, Coherenceì— ìŒ“ì´ëŠ” Cache ê°€ ë§¤ìš° ë§ì•„ Reaperê°€ ë™ì‘í•˜ì§€ ì•ŠëŠ” ë¬¸ì œê°€ ìˆì—ˆë‹¤.</p>

<h4 id="4-cache-serverclient">(4) Cache Server/Client</h4>

<p>Cache Server(Coherence Web), Cache Client(WebLogic Server; MCS)ëŠ” ë¬¼ë¦¬ì ìœ¼ë¡œ ê°™ì€ Nodeì´ë©°</p>

<p>ê¸°ë³¸ì ìœ¼ë¡œ ë‹¤ìŒì˜ ì´ˆê¸° í™˜ê²½ì„ êµ¬ì„±í•˜ì˜€ë‹¤.</p>

<ul>
  <li>
    <p>RHEL 8.7, 2 physical core (4 logic core with hyperthreading), JDK 1.8.0_351</p>
  </li>
  <li>Coherence Server 1 EA
    <ul>
      <li><code class="language-plaintext highlighter-rouge">-Xms2048m -Xmx2048m</code></li>
    </ul>
  </li>
  <li>Managed Coherence Server 1 EA
    <ul>
      <li><code class="language-plaintext highlighter-rouge">-Xms3096m -Xmx3096m</code></li>
      <li><code class="language-plaintext highlighter-rouge">coherence.session.localstorage=false</code></li>
      <li><code class="language-plaintext highlighter-rouge">coherence.reaperdaemon.parallel=true</code></li>
      <li><code class="language-plaintext highlighter-rouge">wm/CoherenceWorkManager</code> : Min(2) / Max(2)</li>
      <li>Deployed â€˜cohSessionAppâ€™
        <ul>
          <li>Session Timeout Secs : 30</li>
          <li>Invalidation Interval Secs : 60</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h3 id="62-50-users">6.2 50 Users</h3>

<p>ê¸°ë³¸ í™˜ê²½ êµ¬ì„±í•œëŒ€ë¡œ, 50 Users ë°˜ë³µ ìš”ì²­ ì‹œì— ìŒ“ì´ëŠ” Session Dataì™€,</p>

<p>30 Secs ë§ˆë‹¤ Sessionì€ Invalid ëœë‹¤.</p>

<p>Invalid ëœ Sessionì„ ì •ë¦¬í•˜ëŠ” Reaper Threadê°€ ì–´ë–»ê²Œ ì‘ì—…ì„ ì´ë£¨ì–´ ëƒˆëŠ”ì§€ Dataë¥¼ ë½‘ì•„ë‚´ì—ˆë‹¤.</p>

<p>JMeterë¡œ ë¶€í•˜ë¥¼ ì¸ì…í•˜ê³ , WLSTë¡œ Coherenceì— Sessionì´ ì ì¬ëœ ê²ƒì´ ê´€ì¸¡ëœ ìµœì´ˆ ì§€ì ë¶€í„° Dataë¥¼ Grepí•´ë³´ë©´ ëŒ€ëµ ì•„ë˜ì™€ ê°™ì´ ìŒ“ì¸ë‹¤.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre>LastReapCycle | NextReapCycle | AverageReapDuration | LastReapDuration | MaxReapDuration | AverageReapedSessions | MaxReapedSessions | ReapedSessions | ReapedSessionsTotal | SessionUpdates | OverflowUpdates

...

1 | Tue May 30 16:02:33 KST 2023 | Tue May 30 16:03:33 KST 2023 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 278 | 275
2 | Tue May 30 16:02:33 KST 2023 | Tue May 30 16:03:33 KST 2023 | 0 | 0 | 0 | 0 | 0 | 0 | 

...

71 | Tue May 30 16:08:43 KST 2023 | Tue May 30 16:09:43 KST 2023 | 11485 | 5898 | 20649 | 6243 | 9865 | 5381 | 37458 | 37303 | 37289

...
</pre></td></tr></tbody></table></code></pre></div></div>

<p>JMeterë¡œ 300 Secs ë™ì•ˆ ìš”ì²­ì´ ì¸ì…ë˜ê³  ë‚œë’¤ì—ëŠ” ì¢…ë£Œë  ê²ƒì´ë‹¤.</p>

<p>ì´ˆê¸°, Session Dataê°€ ê´€ì¸¡ë˜ì§€ ì•ŠëŠ” (SessionUpdates ê°€ 0) DataëŠ” ì œì™¸.</p>

<p>ë§ê¸°, Session Dataê°€ ë” ì´ìƒ ì •ë¦¬ë  ê²ƒì´ ì—†ëŠ” (ReapedSessionsTotalì´ SessionUpdates ì— ê°€ê¹Œì›€) Data ê¹Œì§€ë§Œ ìˆ˜ì§‘í•œë‹¤.</p>

<p>í‰ê·  ë˜ëŠ” ìˆ˜ì§‘ëœ ë°ì´í„°ë¥¼ ë³´ë©´,</p>

<table>
  <thead>
    <tr>
      <th>AverageReapDuration</th>
      <th>LastReapDuration</th>
      <th>MaxReapDuration</th>
      <th>AverageReapedSessions</th>
      <th>MaxReapedSessions</th>
      <th>ReapedSessions</th>
      <th>ReapedSessionsTotal</th>
      <th>SessionUpdates</th>
      <th>OverflowUpdates</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>4520.352113</td>
      <td>9164.901408</td>
      <td>12129</td>
      <td>2680.43662</td>
      <td>9631</td>
      <td>6347.28169</td>
      <td>38257</td>
      <td>38123</td>
      <td>38078</td>
    </tr>
  </tbody>
</table>

<p>AverageReapDuration : Reapì— ì†Œìš”ëœ í‰ê·  ì‹œê°„ (í‰ê· ê°’)</p>

<p>LastReapDuration : ê°€ì¥ ë§ˆì§€ë§‰ Reapì— ì†Œìš”ëœ ì‹œê°„ (í‰ê· ê°’)</p>

<p>MaxReapDuration : Reapì— ì†Œìš”ëœ ìµœëŒ€ ì‹œê°„ (ìµœëŒ€ê°’)</p>

<p>AverageReapedSessions : Reaped Sessionì˜ í‰ê·  ê°¯ìˆ˜, í‰ê· ì ìœ¼ë¡œ Reap 1 Cycle ë‹¹ ëª‡ê°œì˜ Sessionì´ Reaped ë˜ëŠ”ì§€ë¥¼ ë‚˜íƒ€ëƒ„ (í‰ê· ê°’)</p>

<p>MaxReapedSessions : Reaped Sessionì˜ ìµœëŒ€ ê°¯ìˆ˜, í•œë²ˆì— ìµœëŒ€ ëª‡ê°œì˜ Sessionì´ Reaped ë˜ì—ˆëŠ”ì§€ë¥¼ ë‚˜íƒ€ëƒ„ (ìµœëŒ€ê°’)</p>

<p>ReapedSessions : Reap 1 Cycle ë‹¹ í•œë²ˆì— ëª‡ê°œì˜ Sessionì´ Reaped ë˜ì—ˆëŠ”ì§€ ë‚˜íƒ€ëƒ„ (í‰ê· ê°’)</p>

<p>ReapedSessionTotal : ì§€ê¸ˆê¹Œì§€ ì´í•© Reaped Session ê°¯ìˆ˜ (ìµœëŒ€ê°’)</p>

<p>SessionUpdates : Sessionì´ ë§Œë“¤ì–´ì§€ê±°ë‚˜, Touched ë˜ì—ˆì„ ë•Œ ì§‘ê³„ ë¨ (ìµœëŒ€ê°’)</p>

<p>OverflowUpdates : OverflowëŠ” í° Session Dataë¥¼ ì €ì¥í•  ë•Œ ì‚¬ìš©ë˜ëŠ” Modelì´ë©°, OverflowThreshold(default 1024) í¬ê¸°ë¥¼ ë„˜ì–´ì„œëŠ” Sessionì˜ ì´ Updates ê°¯ìˆ˜ê°€ ì§‘ê³„ë¨. (ìµœëŒ€ê°’)</p>

<p>í‰ê· ì— ì˜ë¯¸ê°€ ì—†ëŠ” ê°’ë“¤ì€, ìµœëŒ€ê°’ìœ¼ë¡œ ìˆ˜ì§‘í–ˆë‹¤.</p>

<h3 id="63-50-users--4-threads">6.3 50 Users / 4 Threads</h3>

<p>ì•ì„œ, WebLogic WorkManagerì— ì˜í•´ Min/Maxê°€ 2 Threadsë¡œ í™˜ê²½ì„ êµ¬ì„±í•˜ì—¬ í…ŒìŠ¤íŠ¸í–ˆë‹¤ë©´,</p>

<p>ì´ë²ˆì—ëŠ” 4 Threadsë¡œ êµ¬ì„±í•˜ì—¬ ê°œì„ ë˜ëŠ”ì§€ ì‚´í´ë³¸ë‹¤.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre>  <span class="nt">&lt;self-tuning&gt;</span>
    <span class="nt">&lt;min-threads-constraint&gt;</span>
      <span class="nt">&lt;name&gt;</span>MinThreadsConstraint-0<span class="nt">&lt;/name&gt;</span>
      <span class="nt">&lt;target&gt;</span>myCluster<span class="nt">&lt;/target&gt;</span>
      <span class="nt">&lt;count&gt;</span>4<span class="nt">&lt;/count&gt;</span>
    <span class="nt">&lt;/min-threads-constraint&gt;</span>
    <span class="nt">&lt;max-threads-constraint&gt;</span>
      <span class="nt">&lt;name&gt;</span>MaxThreadsConstraint-0<span class="nt">&lt;/name&gt;</span>
      <span class="nt">&lt;target&gt;</span>myCluster<span class="nt">&lt;/target&gt;</span>
      <span class="nt">&lt;count&gt;</span>4<span class="nt">&lt;/count&gt;</span>
    <span class="nt">&lt;/max-threads-constraint&gt;</span>
    <span class="nt">&lt;work-manager&gt;</span>
      <span class="nt">&lt;name&gt;</span>wm/CoherenceWorkManager<span class="nt">&lt;/name&gt;</span>
      <span class="nt">&lt;target&gt;</span>myCluster<span class="nt">&lt;/target&gt;</span>
    <span class="nt">&lt;/work-manager&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>í‰ê· ì€,</p>

<table>
  <thead>
    <tr>
      <th>AverageReapDuration</th>
      <th>LastReapDuration</th>
      <th>MaxReapDuration</th>
      <th>AverageReapedSessions</th>
      <th>MaxReapedSessions</th>
      <th>ReapedSessions</th>
      <th>ReapedSessionsTotal</th>
      <th>SessionUpdates</th>
      <th>OverflowUpdates</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>4446.315068</td>
      <td>8821.205479</td>
      <td>13252</td>
      <td>2884.260274</td>
      <td>9754</td>
      <td>6474.520548</td>
      <td>37743</td>
      <td>37582</td>
      <td>37551</td>
    </tr>
  </tbody>
</table>

<p>ê²€ì¦ì„ ìœ„í•´, ë™ì¼í•˜ê²Œ í•œë²ˆ ë” í…ŒìŠ¤íŠ¸í•˜ì˜€ëŠ”ë° ì•„ë˜ì™€ ê°™ë‹¤.</p>

<table>
  <thead>
    <tr>
      <th>AverageReapDuration</th>
      <th>LastReapDuration</th>
      <th>MaxReapDuration</th>
      <th>AverageReapedSessions</th>
      <th>MaxReapedSessions</th>
      <th>ReapedSessions</th>
      <th>ReapedSessionsTotal</th>
      <th>SessionUpdates</th>
      <th>OverflowUpdates</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>3637.561644</td>
      <td>10007.67123</td>
      <td>14751</td>
      <td>2068.520548</td>
      <td>9829</td>
      <td>6447.589041</td>
      <td>38384</td>
      <td>38203</td>
      <td>38255</td>
    </tr>
  </tbody>
</table>

<p>ì´ì™¸ì—ë„ ì—¬ëŸ¬ë²ˆì˜ í…ŒìŠ¤íŠ¸ë¥¼ í•´ë³´ì•˜ëŠ”ë°, ê²°ê³¼ë§ˆë‹¤ í¸ì°¨ê°€ ì¡°ê¸ˆ ì‹¬í•œ í¸ì´ì§€ë§Œ ëŒ€ì²´ì ìœ¼ë¡œ Reaper Threadë¥¼ ëŠ˜ë ¤ ê°œì„ ì´ ë˜ëŠ” ê²ƒì€ í™•ì¸ì´ ëœë‹¤.</p>

<h3 id="64-50-users--8-threads">6.4 50 Users / 8 Threads</h3>

<p>í‰ê· ì€,</p>

<table>
  <thead>
    <tr>
      <th>AverageReapDuration</th>
      <th>LastReapDuration</th>
      <th>MaxReapDuration</th>
      <th>AverageReapedSessions</th>
      <th>MaxReapedSessions</th>
      <th>ReapedSessions</th>
      <th>ReapedSessionsTotal</th>
      <th>SessionUpdates</th>
      <th>OverflowUpdates</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>4944.534247</td>
      <td>9499.547945</td>
      <td>13958</td>
      <td>2801.657534</td>
      <td>9838</td>
      <td>6346.931507</td>
      <td>37692</td>
      <td>37577</td>
      <td>37579</td>
    </tr>
  </tbody>
</table>

<p>ì¬ì°¨ í…ŒìŠ¤íŠ¸ ì‹œì—,</p>

<table>
  <thead>
    <tr>
      <th>AverageReapDuration</th>
      <th>LastReapDuration</th>
      <th>MaxReapDuration</th>
      <th>AverageReapedSessions</th>
      <th>MaxReapedSessions</th>
      <th>ReapedSessions</th>
      <th>ReapedSessionsTotal</th>
      <th>SessionUpdates</th>
      <th>OverflowUpdates</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>6347.72</td>
      <td>9040.72</td>
      <td>16162</td>
      <td>3886.213333</td>
      <td>9784</td>
      <td>6437.76</td>
      <td>38259</td>
      <td>38072</td>
      <td>38081</td>
    </tr>
  </tbody>
</table>

<p>ì˜¤íˆë ¤ ê°ì†Œí•˜ê¸°ë„ í•˜ê³ , íŠ¹ë³„íˆ ë“œë¼ë§ˆí‹±í•œ ë³€í™”ê°€ ì—†ë‹¤.</p>

<h3 id="65-50-users--12-threads">6.5 50 Users / 12 Threads</h3>

<p>í‰ê· ì€,</p>

<table>
  <thead>
    <tr>
      <th>AverageReapDuration</th>
      <th>LastReapDuration</th>
      <th>MaxReapDuration</th>
      <th>AverageReapedSessions</th>
      <th>MaxReapedSessions</th>
      <th>ReapedSessions</th>
      <th>ReapedSessionsTotal</th>
      <th>SessionUpdates</th>
      <th>OverflowUpdates</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>3344.381579</td>
      <td>8949.065789</td>
      <td>22647</td>
      <td>1913.447368</td>
      <td>9654</td>
      <td>6253.592105</td>
      <td>38098</td>
      <td>37919</td>
      <td>37915</td>
    </tr>
  </tbody>
</table>

<p>ì¬ì°¨ í…ŒìŠ¤íŠ¸,</p>

<table>
  <thead>
    <tr>
      <th>AverageReapDuration</th>
      <th>LastReapDuration</th>
      <th>MaxReapDuration</th>
      <th>AverageReapedSessions</th>
      <th>MaxReapedSessions</th>
      <th>ReapedSessions</th>
      <th>ReapedSessionsTotal</th>
      <th>SessionUpdates</th>
      <th>OverflowUpdates</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>6243.068493</td>
      <td>9646.287671</td>
      <td>13999</td>
      <td>3526.219178</td>
      <td>9837</td>
      <td>6268.753425</td>
      <td>37427</td>
      <td>37278</td>
      <td>37320</td>
    </tr>
  </tbody>
</table>

<h3 id="66-overflowupdates">6.6 OverflowUpdates</h3>

<p>OverflowUpdates : OverflowëŠ” í° Session Dataë¥¼ ì €ì¥í•  ë•Œ ì‚¬ìš©ë˜ëŠ” Modelì´ë©°, OverflowThreshold(default 1024) í¬ê¸°ë¥¼ ë„˜ì–´ì„œëŠ” Sessionì˜ ì´ Updates ê°¯ìˆ˜ê°€ ì§‘ê³„ë¨.</p>

<p>Test Appì—ì„œ ìƒì„±í•˜ëŠ” Session Dataì˜ Sizeë¥¼ 1024 bytes ë³´ë‹¤ ì‘ê²Œ ë§Œë“¤ ê²½ìš°,</p>

<p>SessionUpdatesëŠ” ì¦ê°€í•˜ë˜, OverflowUpdatesëŠ” ì¦ê°€í•˜ì§€ ì•Šì„ ê²ƒìœ¼ë¡œ ë³´ì´ëŠ”ë°,</p>

<p>ì´ ë¶€ë¶„ì„ ê²€ì¦í•˜ê¸° ìœ„í•´ì„œ Session Data ì˜ ì •í™•í•œ Sizeë¥¼ Inspect í•´ì•¼ í•œë‹¤.</p>

<p>JFR, Heap Dump, Instrumentation.getObjectSize ë“±ë“± ì—¬ëŸ¬ê°€ì§€ë¥¼ í™•ì¸í•´ë³´ê³  ìˆìœ¼ë‚˜,</p>

<p>ê»ë°ê¸° Sizeë§Œ í™•ì¸ë˜ëŠ” ë“± ì •í™•í•œ ìˆ˜ì¹˜ê°€ ë‚˜ì˜¤ì§ˆ ì•Šì•„ ì¢€ ë” í™•ì¸í•´ë´ì•¼ í•˜ëŠ” ë¶€ë¶„ì´ë‹¤.</p>

<p>ì´í›„ì—, ì—¬ëŸ¬ë‚ ì— ê±¸ì³ í™•ì¸ì„ í•´ë³´ì•˜ëŠ”ë° openjdk ì˜ JOL(Java Object Layout) Library ë¥¼ í™œìš©í•˜ì—¬ Object Sizeë¥¼ ì¸¡ì •í•  ìˆ˜ ìˆì—ˆë‹¤.</p>

<p><a href="http://localhost:4000/programming/Java-Object-Layout">Java-Object-Layout</a> Post ì—ì„œ ë‹¤ë£¨ì—ˆë‹¤.</p>

<p>Postì— ë”°ë¥´ë©´, _obj Byte Arrayë¥¼ ì •í™•íˆ ì‹¤ì œ í¬ê¸° 1024 Bytesì— ë§ì¶”ê¸° ìœ„í•´ì„œëŠ”</p>

<ul>
  <li>Header bytes 16 ë¥¼ ë¹¼ê³ </li>
  <li>Gap 8bytes ì˜ ë°°ìˆ˜ì— ë§ê²Œë”</li>
</ul>

<p>ì„¤ì •í•˜ë©´ ëœë‹¤ê³  í–ˆë‹¤.</p>

<p>ê·¸ëŸ¬ë¯€ë¡œ _obj Byte Array ê°¯ìˆ˜ëŠ” ì •í™•íˆ 1008 ê°œë¥¼ ë§Œë“¤ë©´, ì‹¤ì œ JVM Heap Memoryì— ì˜¬ë¼ê°€ëŠ” Object SizeëŠ” 1024 Bytesê°€ ëœë‹¤.</p>

<p><code class="language-plaintext highlighter-rouge">byte[] _obj = new byte[1008];</code></p>

<p>ì´ì œ Coherence Session Dataë¥¼ Update í•˜ê³  MBeanì„ ì‚´í´ë³´ë©´</p>

<ul>
  <li>OverflowThreshold : 1024</li>
  <li>OverflowUpdates : 0</li>
  <li>OverflowMaxSize : 0</li>
</ul>

<p>Session Dataê°€ 1024 bytes ë³´ë‹¤ ì‘ê¸° ë•Œë¬¸ì—, 1íšŒ í˜¸ì¶œ ì‹œì—ëŠ” Overflow cache ê°€ ì•„ë‹Œ ê²ƒì´ í™•ì¸ëœë‹¤.</p>

<p>ì—°ì† 2íšŒ í˜¸ì¶œí•˜ì—¬, Session Data í¬ê¸°ë¥¼ ì¦ë¶„ ì‹œí‚¤ë©´,</p>

<ul>
  <li>OverflowThreshold : 1024</li>
  <li>OverflowUpdates : 1</li>
  <li>OverflowMaxSize : 2019</li>
</ul>

<p>ì˜ˆìƒê°’ 2032 Bytes ë³´ë‹¤ ì‘ì€ 2019 Bytesë¡œ í™•ì¸ë˜ë©°, Overflow ê°€ update ë˜ì—ˆë‹¤.</p>

<p>ì—°ì† í˜¸ì¶œì„ ë” ì—¬ëŸ¬ë²ˆ í•´ë³´ì•˜ëŠ”ë°, í•­ìƒ JVM Heap memory ì— ì ì¬ë˜ëŠ” ì‹¤ì œ Sizeë³´ë‹¤ í•­ìƒ 13 Bytesê°€ ì ê²Œ ì¸¡ì •ë˜ì—ˆë‹¤.</p>

<p>Coherence ì˜ Sessionì„ ë‹¤ë£¨ëŠ” Objectë¥¼ JOLë¡œ í™•ì¸í•´ë³´ê³  ì‹¶ìœ¼ë‚˜, Object ë¥¼ íŠ¹ì •ì§“ì§€ ëª»í•˜ì˜€ë‹¤.</p>

<h2 id="7-outcomes">7. Outcomes</h2>

<p>ì„±ëŠ¥ì´ ì¢‹ì§€ ì•Šì€ Local Test í™˜ê²½ì—ì„œëŠ” 4 Reaper Thread í™˜ê²½ ë¶€í„° ê·¸ë‚˜ë§ˆ Tuning ì˜ ê²°ê³¼ê°€ í™•ì¸ì´ ëœë‹¤.</p>

<p>ê·¸ëŸ¼ì—ë„ ë°˜ë³µ ìˆ˜í–‰ ì‹œ Local Test í™˜ê²½ì˜ ì˜í–¥ì¸ì§€, ë“¤ì‘¥ ë‚ ì‘¥í•˜ê³  ë“œë¼ë§ˆí‹±í•œ ê²°ê³¼ë¥¼ ë³´ì—¬ì£¼ì§€ëŠ” ì•ŠëŠ”ë‹¤.</p>

<p>Test ê²°ê³¼ ë˜í•œ ì¢‹ì•˜ìœ¼ë©´ í–ˆì§€ë§Œ ê·¸ë ‡ì§€ ì•Šì•˜ìœ¼ë¯€ë¡œ</p>

<p>MBean í•­ëª©ì— ëŒ€í•œ ì´í•´ë¥¼ ì–»ì€ ê²ƒìœ¼ë¡œ ë§ˆë¬´ë¦¬ í•´ì•¼ í•  ë“¯ ì‹¶ë‹¤.</p>

<p>ê·¸ ì™¸ì—ë„, JOL ì„ ì´ìš©í•˜ì—¬ Overflowupdate ê¸°ì¤€ì„ ì‹¤ì œ ì¶”ì í•˜ëŠ” Testë„ ì§„í–‰í•  ìˆ˜ ìˆì—ˆë‹¤.</p>

<h2 id="8-references">8. References</h2>

<p><a href="https://docs.oracle.com/en//middleware/standalone/coherence/14.1.1.0/administer-http-sessions/monitoring-applications.html#GUID-93AB0B53-6335-4E55-B66C-8CA566EEE8A0">Overflow ê´€ë ¨</a></p>

<p><a href="https://dhkim900331.github.io/coherence/How-To-Monitor-Coherence-Web-3#h-32-mbean-%ED%95%AD%EB%AA%A9-%EC%84%A4%EB%AA%85">WLSTë¡œ ìˆ˜ì§‘ë˜ëŠ” MBean í•­ëª© ë¶€ì—° ì„¤ëª… ê´€ë ¨ ìë£Œ</a></p>

<p><a href="http://localhost:4000/programming/Java-Object-Layout">Java-Object-Layout</a></p>

<p><a href="https://docs.oracle.com/en/middleware/fusion-middleware/coherence/12.2.1.4/develop-applications/setting-cluster.html#GUID-D3FDEDBF-B97A-4C8D-BEFF-AB54C9D94CB5">Specifying a Clusterâ€™s Multicast Address and Port</a></p>

<p><strong>Recommended Thread-count-min And Thread-count-max Values in Coherence (Doc ID 2294067.1)</strong></p>

<p><strong>Explanation Of Meaning For Coherence Threadpool Error Message (Doc ID 2728051.1)</strong></p>
:ET