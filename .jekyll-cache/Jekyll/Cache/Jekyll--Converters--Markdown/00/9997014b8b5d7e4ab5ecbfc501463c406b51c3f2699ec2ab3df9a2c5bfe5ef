I"œ<h2 id="1-ê°œìš”">1. ê°œìš”</h2>

<ul>
  <li>Tomcat Thread Dump ë¶„ì„ì„ í•˜ë‹¤ê°€, ìˆ˜ ë§ì€ Dump íŒŒì¼ì—ì„œ ìˆ˜ ë§ì€ Thread ìƒíƒœë¥¼ ì¶”ì í•´ì•¼ ë  í•„ìš”ê°€ ìˆì—ˆë‹¤.</li>
  <li>ì—¬ëŸ¬ íŒŒì¼ì„ ì—´ì–´, íŠ¹ì • ë‚´ìš©ë“¤ì„ ì¶”ì¶œí•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì§°ë‹¤.
    <ul>
      <li>ìˆ˜ ë§ì€ ë¤í”„ì˜ ìœ ì—°í•˜ê²Œ ë³€í™”í•˜ëŠ” ë‚´ìš©ì„ ë‹¨ìˆœ ìŠ¤í¬ë¦½íŠ¸ë¡œ ë³¼ ìˆ˜ ì—†ë‹¤.</li>
      <li>ê·¸ëƒ¥ ì°¸ê³ ìš©ì´ë‹¤~</li>
    </ul>
  </li>
</ul>

<p><br /><br /># 2. ì„¤ëª…</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td><td class="rouge-code"><pre><span class="c"># Thread DumpíŒŒì¼ëª…* ìœ¼ë¡œ ì¼ê´„ ê²€ìƒ‰</span>
<span class="nv">FILE</span><span class="o">=</span>/tmp/??<span class="k">*</span>
<span class="nv">FILE_LIST</span><span class="o">=</span><span class="si">$(</span><span class="nb">ls</span> <span class="nt">-al</span> <span class="k">${</span><span class="nv">FILE</span><span class="k">}</span> | <span class="nb">awk</span> <span class="s1">'{print $NF}'</span><span class="si">)</span>
<span class="nb">echo</span> <span class="s2">"</span><span class="k">${</span><span class="nv">FILE_LIST</span><span class="k">}</span><span class="s2">"</span> | <span class="se">\</span>
<span class="k">while </span><span class="nb">read </span>FILE<span class="p">;</span>
<span class="k">do</span>
		<span class="c"># Thread Dump íŒŒì¼ 1ê°œë§ˆë‹¤, ë‚´ìš© ê²€ìƒ‰</span>
        <span class="nb">echo
        echo</span> <span class="s2">"#############################"</span>
        <span class="nb">echo</span> <span class="s2">"########## </span><span class="k">${</span><span class="nv">FILE</span><span class="k">}</span><span class="s2"> ##########"</span>
        <span class="nb">echo</span> <span class="s2">"#############################"</span>
        <span class="nb">echo

        grep</span> <span class="nt">-n</span> <span class="s2">"catalina-exec"</span> <span class="k">${</span><span class="nv">FILE</span><span class="k">}</span> | <span class="se">\</span>
        <span class="nb">cut</span> <span class="nt">-d</span> <span class="s1">':'</span> <span class="nt">-f1</span> | <span class="se">\</span>
        <span class="k">while </span><span class="nb">read </span>TXT<span class="p">;</span>
        <span class="k">do
                </span><span class="nb">sed</span> <span class="nt">-n</span> <span class="s2">"</span><span class="k">${</span><span class="nv">TXT</span><span class="k">}</span><span class="s2">,</span><span class="k">$((</span>TXT+1<span class="k">))</span><span class="s2">p"</span> <span class="k">${</span><span class="nv">FILE</span><span class="k">}</span>
        <span class="k">done

done</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<blockquote>
  <p>Line 2. ìˆ˜ ë§ì€ Dump íŒŒì¼ë“¤ì„ í•œë²ˆì— ì¡°íšŒí•˜ê¸° ìœ„í•´ íŒŒì¼ëª…* ìœ¼ë¡œ ì§€ì •í•œë‹¤.</p>

  <p>Line 3-5. ìˆ˜ ë§ì€ Dump íŒŒì¼ë“¤ì„ 1ê°œì”© ì¡°íšŒí•˜ê¸° ìœ„í•´ while read ë¡œ ë„˜ê¸´ë‹¤.</p>

  <p>Line 14-16. 1ê°œ Dump íŒŒì¼ì—ì„œ <code class="language-plaintext highlighter-rouge">catalina-exec</code> Thread ëª…ì„ ê²€ìƒ‰í•˜ê³ , í•´ë‹¹ Line numberë¥¼ while read ë¡œ ë„˜ê¸´ë‹¤.</p>

  <p>Line 18. <code class="language-plaintext highlighter-rouge">catalina-exec</code> Thread ëª… ë°‘ì— Thread <code class="language-plaintext highlighter-rouge">State</code> ê°€ ë‚˜ì˜¤ë¯€ë¡œ +1 í•˜ì—¬ ë³¸ë‹¤.</p>
</blockquote>

<h3><br /><br /></h3>

<p><br />
Thread Dump ë¥¼ ìë™ìœ¼ë¡œ ëœ¨ë ¤ë©´â€¦</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span><span class="k">while </span><span class="nb">true</span><span class="p">;</span> <span class="se">\</span>
<span class="k">do</span> <span class="se">\</span>
<span class="nb">sleep </span>1 <span class="o">&amp;&amp;</span> <span class="se">\</span>
<span class="nv">JAVA_HOME</span><span class="o">=</span>/usr/java/jdk-8u292-ojdkbuild-linux-x64 <span class="o">&amp;&amp;</span> <span class="se">\</span>
<span class="nv">PID</span><span class="o">=</span><span class="si">$(</span><span class="k">${</span><span class="nv">JAVA_HOME</span><span class="k">}</span>/bin/jps <span class="nt">-v</span> | <span class="nb">grep</span> <span class="s2">"wasDocker"</span> | <span class="nb">awk</span> <span class="s1">'{print $1}'</span><span class="si">)</span> <span class="o">&amp;&amp;</span> <span class="se">\</span>
<span class="k">${</span><span class="nv">JAVA_HOME</span><span class="k">}</span>/bin/jstack <span class="nt">-l</span> <span class="k">${</span><span class="nv">PID</span><span class="k">}</span> <span class="o">&gt;</span> /tmp/<span class="k">${</span><span class="nv">PID</span><span class="k">}</span>.<span class="si">$(</span><span class="nb">date</span> <span class="s2">"+%Y-%m-%d_%H:%M:%S"</span><span class="si">)</span>
<span class="k">done</span>
</pre></td></tr></tbody></table></code></pre></div></div>
:ET